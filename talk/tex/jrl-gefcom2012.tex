\input{../include/header_beamer}

\usecolortheme{default}
\xdefinecolor{Black}{rgb}{0,0,0}
\xdefinecolor{White}{rgb}{1,1,1}
\xdefinecolor{DarkBlue}{rgb}{0,0,.7}
\xdefinecolor{DarkRed}{rgb}{.7,0,0}
\xdefinecolor{Red}{rgb}{.85,0,0}
\xdefinecolor{DarkGreen}{rgb}{0,.7,0}
\xdefinecolor{DarkMagenta}{rgb}{.6,0,.6}
\def\Black{\textcolor{Black}}
\def\White{\textcolor{White}}
\def\Blue{\textcolor{DarkBlue}}
\def\Magenta{\textcolor{DarkMagenta}}
\def\Red{\textcolor{Red}}
\def\Green{\textcolor{DarkGreen}}
\definecolor{camlightblue}{rgb}{0.601 , 0.8, 1}

\input{../include/commenting.tex}

%% For submission, make all render blank.
%\renewcommand{\LATER}[1]{}
%\renewcommand{\fLATER}[1]{}
%\renewcommand{\TBD}[1]{}
%\renewcommand{\fTBD}[1]{}
%\renewcommand{\PROBLEM}[1]{}
%\renewcommand{\fPROBLEM}[1]{}
%\renewcommand{\NA}[1]{#1}  %% Note, NA's pass through!

\usepackage{alltt}
\usepackage{psfrag}
\usepackage{pstool}
\usepackage{multicol}
\usepackage{tabularx}
\usepackage{preamble}

\def\newarrow{\mbox{\begin{tikzpicture}
             \useasboundingbox{(-3pt,-4.5pt) rectangle (19pt,1pt)};
             \draw[->] (0,-0.07)--(17pt,-0.07);\end{tikzpicture}}}

\title[] % (optional, use only with long paper titles)
{GEFCom2012 Hierarchical load forecasting:\\Gradient boosting machines and Gaussian processes}

\author % (optional, use only with lots of authors)
{James Robert Lloyd}
% - Use the \inst{?} command only if the authors have different
%   affiliation.

\institute[] % (optional, but mostly needed)
{Machine Learning Group,\\Department of Engineering,\\University of Cambridge}
% - Use the \inst command only if there are several affiliations.
% - Keep it simple, no one is interested in your street address.

\date % (optional)
{July 2013}

\subject{Talks}

\usetikzlibrary{shapes.geometric,arrows,chains,matrix,positioning,scopes}
 \makeatletter
 \tikzset{join/.code=\tikzset{after node path={%
       \ifx\tikzchainprevious\pgfutil@empty\else(\tikzchainprevious)%
       edge[every join]#1(\tikzchaincurrent)\fi}}
 }
 \tikzset{>=stealth',every on chain/.append style={join},
   every join/.style={->}
 }

\tikzstyle{mybox} = [draw=white, rectangle]
\usepackage{ifthen}
\usepackage{booktabs}

% Custom definitions
\def\simiid{\sim_{\mbox{\tiny iid}}}
\def\ie{i.e.\ }
\def\eg{e.g.\ }

%%%%
% Paper specific stuff
%%%%

\begin{document}

\small
%% { 
%%   \setbeamertemplate{footline}{\empty}
%%   \begin{frame}
%%     \titlepage
%%   \end{frame}
%% }
%\renewcommand{\inserttotalframenumber}{11}

%\input{../include/defs}

\begin{frame}
  \begin{block}{}
    \titlepage
  \end{block}
  \begin{center}
    {\bf  Thanks to}\\
    Alex Davies\\
    David Duvenaud\\
    Zoubin Ghahramani
  \end{center}
\end{frame}

\begin{frame}{Overview of techniques}
  \begin{block}{Preprocessing}
    %\vspace{\baselineskip}
    \begin{itemize}
      \item Kernel smoothing of temperatures
    \end{itemize}
  \end{block}
  \vspace{\baselineskip}
  \begin{block}{Temperature forecasting}
    %\vspace{\baselineskip}
    \begin{itemize}
      \item Gaussian process (GP) regression
    \end{itemize}
  \end{block}
  \vspace{\baselineskip}
  \begin{block}{Load back/forecasting}
    %\vspace{\baselineskip}
    \begin{itemize}
      \item Gradient boosting machine (GBM) regression  - 76\%
      \item Gaussian process (GP) regression - 14\%
      \item Linear regression (benchmark solution) - 10\%
    \end{itemize}
  \end{block}
\end{frame}

\begin{frame}{Summary of results}
  \begin{center}
    \begin{tabular}{lcc|ccc}
      Method &&&&& Validation score\\\\
      \hline\\
      GBM &&&&& 72,968 \\\\
      GP &&&&& 99,787 \\\\
      LR &&&&& 112,547 \\\\
      \hline\\
      Ensemble &&&&& 71,164
    \end{tabular}
  \end{center}
\end{frame}

\begin{frame}{Notation}
  \begin{center}
    \begin{tabular}{lcccl}
      $t$ &&&& Time \\\\
      $T$ &&&& Temperature \\\\
      $S$ &&&& Kernel smoothed temperature \\\\
      $Z$ &&&& Load \\\\
      $f,g$ &&&& Generic functions \\\\
      $\varepsilon$ &&&& Generic error
    \end{tabular}
  \end{center}
\end{frame}

\begin{frame}{Main approach - regression on time and temp.}
  \begin{block}{Modelling temperatures and loads as functions of time and temperature}
    \begin{eqnarray*}
      T(t) & = & f(t) + \varepsilon^T_t \\
      \\
      Z(t) & = & g(t, T(t), S(t)) + \varepsilon^Z_t \\
    \end{eqnarray*}
  \end{block}
  \begin{block}{\ie no explicit autoregressive components \eg}
    \begin{eqnarray*}
      y(t+1) & = & f(y(t)) + \varepsilon_t
    \end{eqnarray*}
  \end{block}
\end{frame}

\begin{frame}{GBM regression}
  \begin{block}{Used as a regression `black-box'}
    \begin{itemize}
      \item Boosted decision trees
      \item Also employs bagging
    \end{itemize}
  \end{block}
  \begin{block}{Output}
  	\begin{itemize}
      \item $Z_i$ \ie each load zone modelled in isolation
    \end{itemize}
  \end{block}
  \begin{block}{Inputs}
    \begin{itemize}
      \item Time of day
      \item Time within week
      \item Temperatures (all stations)
      \item Smoothed temperatures (all stations)
    \end{itemize}
  \end{block}
\end{frame}

\begin{frame}{GBM regression}
  Mention how I chose parameters
\end{frame}

\begin{frame}{GBM regression}
  \begin{centering}
    \input{../include/gbm}
    Only slight discontinuity between prediction and ground truth
  \end{centering}
\end{frame}

\begin{frame}{Gaussian process regression}
  \begin{itemize}
    \item A Bayesian nonparametric method for regression
    \vspace{\baselineskip}
    \item Places a prior on functions
    \vspace{\baselineskip}
    \item Typically used as a smoothing device by choosing a default \emph{kernel}
    \vspace{\baselineskip}
    \item Data exhibiting high level structure (\eg periodicity) can be modelled using more advanced kernels
  \end{itemize}
\end{frame}

\begin{frame}{Prior on functions}
  \begin{centering}
    \input{../include/SE}
  \end{centering}
\end{frame}

\frame[plain]{
\frametitle{Conditional Posterior}

\begin{align*}
f(x^*) | X, y \sim \mathcal{N}( & k( x^*, X ) K^{-1} y, \\
& k( x^*, x^* ) - k( x^*, X ) K^{-1} k( X, x^* ) )
\end{align*}


With SE kernel:
    \begin{figure}
        \includegraphics<1>[width=6cm]{../include/gp_demo/1d_posterior_and_0_data}
        \includegraphics<2>[width=6cm]{../include/gp_demo/1d_posterior_and_1_data}
        \includegraphics<3>[width=6cm]{../include/gp_demo/1d_posterior_and_2_data}
        \includegraphics<4>[width=6cm]{../include/gp_demo/1d_posterior_and_3_data}
        \includegraphics<5>[width=6cm]{../include/gp_demo/1d_posterior_and_4_data}
    \end{figure}
}

\frame[plain]{
\frametitle{Smoothing not always enough}
\begin{itemize} 
	\item SE kernel $\rightarrow$ basic smoothing.
	\item Richer kernels means richer structure can be captured.
\end{itemize}
\begin{center}
  \input{../include/fig_synth_extrap.tex}
\end{center}
}

\begin{frame}{Smoothing not enough}
  Show an example from the competition data
\end{frame}

\frame[plain]{
\frametitle{Kernel Choice is Important}
\begin{itemize} 
	\item Kernel determines almost all the properties of the prior.
	\item Many different kinds, with very different properties:
\input{../include/tables/simple_kernels_table_v3}
\end{itemize}
}


\frame[plain]{
\frametitle{Kernels can be composed}
\begin{itemize} 
	\item Two main operations: adding, multiplying
	\input{../include/tables/comp1}
\end{itemize}
}

\begin{frame}{Structured kernels}
  Show draws from prior of those used in competition
\end{frame}

\begin{frame}{Structured kernels}
  \begin{centering}
    \input{../include/load_pred}
  \end{centering}
\end{frame}

\begin{frame}{Structured kernels}
  Shameless plug - any time for analysis
\end{frame}

\begin{frame}{Structured kernels for temperature as well}
  Show examples - mention that I split up the modelling of trend and periodicity - mostly through naivety.
\end{frame}

\begin{frame}{Ensembling}
  Show performance of individual components - and correlations of predictions?
  Plug Bayesian optimisation (don't forget Phil Hennig's most recent work)
\end{frame}

{
\section{References}
\section{Extended Bibliography}
\tiny
\begin{frame}[allowframebreaks,plain]
  \frametitle{References}
  \bibliography{library}
  \bibliographystyle{alpha}
\end{frame}
}

\end{document}